#!/usr/bin/python
# coding=utf-8

"""
   命令行处理差异工具
"""
from __future__ import absolute_import, print_function

import os
from docopt import docopt
from turbo import fake
from turbo.util import remove_extension
import shutil

html_template = 
"""
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>hello turbo world</title>
</head>
<body>
    <h1>hello turbo world</h1>
</body>
</html>
"""

server_name = 'app-server'
app_name = 'app'


def build_project(project_templeate_path, project):
    curr_project_path = os.path.abspath(os.path.join('.', project))

    if os.path.exists(curr_project_path):
        print('%s project existed' % project)
        return

    shutil.copytree(project_template_path, curr_project_path)
    for k in ['app-server/__init__.py', '__init__.py']:
        try:
            os.remove(os.path.join(curr_project_path, k))
        except Exception, e:
            pass

    remove_extension(curr_project_path, '.pyc')
    os.makedirs(os.path.join(curr_project_path, 'app-server/templates/app'))
    os.mkdir(os.path.join(curr_project_path, 'app-server/static'))
    with open(os.path.join(curr_project_path, 'app-server/templates/app/index.html'), 'w') as index:
        index.write(html_template)


def build_server():
    pass


def build_app():
    pass



if __name__ == '__main__':
    project_templeate_path = os.path.dirname(fake.__file__)
    project_template_path = os.path.join(project_templeate_path, 'project_template')
    helpdoc = """turbo init project, server or app.
    Usage:
      turbo-admin (-h | --help)
      turbo-admin startproject  <project>
      turbo-admin startserver   <server>
      turbo-admin startapp      <app>

    Options:
      -h,  --help        Show help document
    """
    rgs = docopt(helpdoc)
    if rgs.get('startproject'):
        project = rgs.get('<project>')
        if project:
            build_project(project_template_path, project)
        else:
            print("use 'turbo -h'")

    if rgs.get('startserver'):
        print("turbo-admin startserver <server>")

    if rgs.get('startapp'):
        print("turbo-admin startapp <app>")